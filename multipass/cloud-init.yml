#cloud-config
repo_update: true
repo_upgrade: all

#
# multipass launch --name toolbox --memory 4G --disk 10GB --cloud-init toolbox/multipass/cloud-init.yml
# multipass mount path/to/host/dir toolbox:/home/ubuntu/mount_point
# multipass shell toolbox
# multipass delete toolbox && multipass purge
#
# 要手動項目
# - sudo chsh ubuntu
#

runcmd:
  - apt update

  #
  # base
  #
  - apt install -y git tig wget zip zsh
  - wget https://raw.githubusercontent.com/manabe-mk1/toolbox/master/config/zshrc -O /home/ubuntu/.zshrc
  - chown ubuntu:ubuntu /home/ubuntu/.zshrc

  #
  # docker
  #
  - apt install -y ca-certificates curl gnupg lsb-release
  - >-
    curl -fsSL https://download.docker.com/linux/ubuntu/gpg
    | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
  - >-
    echo "deb [arch=$(dpkg --print-architecture)
    signed-by=/usr/share/keyrings/docker-archive-keyring.gpg]
    https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
    | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
  - apt update
  - apt install -y docker-ce docker-ce-cli containerd.io
  - groupadd docker
  - usermod -aG docker ubuntu

  #
  # docker-compose
  #
  - >-
    curl -L https://github.com/docker/compose/releases/download/v2.4.1/docker-compose-`uname -s`-`uname -m`
    -o /usr/local/bin/docker-compose
  - chmod +x /usr/local/bin/docker-compose
